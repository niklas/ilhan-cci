#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'

require 'optparse'
require 'pp'


$:.unshift File.expand_path('../../lib', __FILE__)
require 'cache'
require 'crunch'
require 'utils'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: #{$1} [options]"

  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    options[:verbose] = v
  end

  opts.on("--width N", Integer, "Width of output image") do |v|
    options[:width] = v
  end
  opts.on("--height N", Integer, "Height of output image") do |v|
    options[:height] = v
  end

  opts.on('--period N', Integer, "Number of values to calculate averages") do |v|
    options[:period] = v
  end
  opts.on('--factor N', Float, "Lambert constant, defaults to 0.015") do |v|
    options[:factor] = v
  end
end.parse!


if $0 == __FILE__
  c = Crunch.new


  Utils.plot(c.values, options.merge(
    output: 'closing.png',
    title: 'Closing values',
  ))
  Utils.plot(c.cci(options), options.merge(
    output: 'cci.png',
    title: 'Commodity Channel Index',
  ))
end
